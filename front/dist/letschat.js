angular.module("templates").run(["$templateCache",function($templateCache){$templateCache.put("/plugins/letschat/letschat.html",'\n<div contrib-letschat-webhooks="contrib-letschat-webhooks" ng-controller="ContribLetsChatAdminController as ctrl">\n  <header>\n    <h1><span class="project-name">{{::project.name}}</span><span class="green">{{::sectionName}}</span></h1>\n  </header>\n  <form>\n    <label for="url">Let\'s Chat webhook url</label>\n    <div class="contrib-form-wrapper">\n      <fieldset class="contrib-input">\n        <input type="text" name="url" ng-model="letschathook.url" placeholder="Let\'s Chat messages endpoint" id="url"/>\n      </fieldset>\n      <fieldset ng-show="letschathook.id"><a href="" title="Test" ng-click="ctrl.testHook()" class="button-gray"><span>Test</span></a></fieldset>\n    </div>\n    <label for="token">Let\'s Chat Auth token</label>\n    <div class="contrib-form-wrapper">\n      <fieldset class="contrib-input">\n        <input type="text" name="token" ng-model="letschathook.token" placeholder="Let\'s Chat auth token" id="token"/>\n      </fieldset>\n    </div>\n    <fieldset>\n      <h2>Notify User Stories</h2>\n      <div class="check-item"><span>Create</span>\n        <div class="check">\n          <input type="checkbox" name="notification" ng-model="letschathook.notify_userstory_create"/>\n          <div></div><span translate="COMMON.YES" class="check-text check-yes"></span><span translate="COMMON.NO" class="check-text check-no"></span>\n        </div>\n      </div>\n      <div class="check-item"><span>Change</span>\n        <div class="check">\n          <input type="checkbox" name="notification" ng-model="letschathook.notify_userstory_change"/>\n          <div></div><span translate="COMMON.YES" class="check-text check-yes"></span><span translate="COMMON.NO" class="check-text check-no"></span>\n        </div>\n      </div>\n      <div class="check-item"><span>Delete</span>\n        <div class="check">\n          <input type="checkbox" name="notification" ng-model="letschathook.notify_userstory_delete"/>\n          <div></div><span translate="COMMON.YES" class="check-text check-yes"></span><span translate="COMMON.NO" class="check-text check-no"></span>\n        </div>\n      </div>\n    </fieldset>\n    <fieldset>\n      <h2>Notify Tasks</h2>\n      <div class="check-item"><span>Create</span>\n        <div class="check">\n          <input type="checkbox" name="notification" ng-model="letschathook.notify_task_create"/>\n          <div></div><span translate="COMMON.YES" class="check-text check-yes"></span><span translate="COMMON.NO" class="check-text check-no"></span>\n        </div>\n      </div>\n      <div class="check-item"><span>Change</span>\n        <div class="check">\n          <input type="checkbox" name="notification" ng-model="letschathook.notify_task_change"/>\n          <div></div><span translate="COMMON.YES" class="check-text check-yes"></span><span translate="COMMON.NO" class="check-text check-no"></span>\n        </div>\n      </div>\n      <div class="check-item"><span>Delete</span>\n        <div class="check">\n          <input type="checkbox" name="notification" ng-model="letschathook.notify_task_delete"/>\n          <div></div><span translate="COMMON.YES" class="check-text check-yes"></span><span translate="COMMON.NO" class="check-text check-no"></span>\n        </div>\n      </div>\n    </fieldset>\n    <fieldset>\n      <h2>Notify Issues</h2>\n      <div class="check-item"><span>Create</span>\n        <div class="check">\n          <input type="checkbox" name="notification" ng-model="letschathook.notify_issue_create"/>\n          <div></div><span translate="COMMON.YES" class="check-text check-yes"></span><span translate="COMMON.NO" class="check-text check-no"></span>\n        </div>\n      </div>\n      <div class="check-item"><span>Change</span>\n        <div class="check">\n          <input type="checkbox" name="notification" ng-model="letschathook.notify_issue_change"/>\n          <div></div><span translate="COMMON.YES" class="check-text check-yes"></span><span translate="COMMON.NO" class="check-text check-no"></span>\n        </div>\n      </div>\n      <div class="check-item"><span>Delete</span>\n        <div class="check">\n          <input type="checkbox" name="notification" ng-model="letschathook.notify_issue_delete"/>\n          <div></div><span translate="COMMON.YES" class="check-text check-yes"></span><span translate="COMMON.NO" class="check-text check-no"></span>\n        </div>\n      </div>\n    </fieldset>\n    <fieldset>\n      <h2>Notify Wiki</h2>\n      <div class="check-item"><span>Create</span>\n        <div class="check">\n          <input type="checkbox" name="notification" ng-model="letschathook.notify_wikipage_create"/>\n          <div></div><span translate="COMMON.YES" class="check-text check-yes"></span><span translate="COMMON.NO" class="check-text check-no"></span>\n        </div>\n      </div>\n      <div class="check-item"><span>Change</span>\n        <div class="check">\n          <input type="checkbox" name="notification" ng-model="letschathook.notify_wikipage_change"/>\n          <div></div><span translate="COMMON.YES" class="check-text check-yes"></span><span translate="COMMON.NO" class="check-text check-no"></span>\n        </div>\n      </div>\n      <div class="check-item"><span>Delete</span>\n        <div class="check">\n          <input type="checkbox" name="notification" ng-model="letschathook.notify_wikipage_delete"/>\n          <div></div><span translate="COMMON.YES" class="check-text check-yes"></span><span translate="COMMON.NO" class="check-text check-no"></span>\n        </div>\n      </div>\n    </fieldset>\n    <button type="submit" class="hidden"></button><a href="" title="Save" ng-click="ctrl.updateOrCreateHook(letschathook)" class="button-green submit-button"><span>Save</span></a>\n  </form>\n  <div class="help-button"><span class="icon icon-help"></span><span>Let\'s Chat messages endpoint :host/rooms/:room_id_or_slug/messages <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>For example: <a>http:\\/\\/localhost:5000\\/rooms\\/54eafca13b8263d2cb5a48b1\\/messages</a></span></div>\n</div>')}]),function(){var LetsChatAdmin,LetsChatWebhooksDirective,debounce,initLetsChatPlugin,module;debounce=function(wait,func){return _.debounce(func,wait,{leading:!0,trailing:!1})},LetsChatAdmin=function(){function LetsChatAdmin(rootScope,scope,repo,appMetaService,confirm,http){this.rootScope=rootScope,this.scope=scope,this.repo=repo,this.appMetaService=appMetaService,this.confirm=confirm,this.http=http,this.scope.sectionName="Let's Chat",this.scope.sectionSlug="letschat",this.scope.$on("project:loaded",function(_this){return function(){var promise;return promise=_this.repo.queryMany("letschat",{project:_this.scope.projectId}),promise.then(function(letschathooks){var description,title;return _this.scope.letschathook={project:_this.scope.projectId,notify_userstory_create:!0,notify_userstory_change:!0,notify_userstory_delete:!0,notify_task_create:!0,notify_task_change:!0,notify_task_delete:!0,notify_issue_create:!0,notify_issue_change:!0,notify_issue_delete:!0,notify_wikipage_create:!0,notify_wikipage_change:!0,notify_wikipage_delete:!0},letschathooks.length>0&&(_this.scope.letschathook=letschathooks[0]),title=_this.scope.sectionName+" - Plugins - "+_this.scope.project.name,description=_this.scope.project.description,_this.appMetaService.setAll(title,description)}),promise.then(null,function(){return _this.confirm.notify("error")})}}(this))}return LetsChatAdmin.$inject=["$rootScope","$scope","$tgRepo","tgAppMetaService","$tgConfirm","$tgHttp"],LetsChatAdmin.prototype.testHook=function(){var promise;return promise=this.http.post(this.repo.resolveUrlForModel(this.scope.letschathook)+"/test"),promise.success(function(_this){return function(_data,_status){return _this.confirm.notify("success")}}(this)),promise.error(function(_this){return function(data,status){return _this.confirm.notify("error")}}(this))},LetsChatAdmin}(),LetsChatWebhooksDirective=function($repo,$confirm,$loading){var link;return link=function($scope,$el,$attrs){var form,submit,submitButton;return form=$el.find("form").checksley({onlyOneErrorElement:!0}),submit=debounce(2e3,function(_this){return function(event){var currentLoading,promise;return event.preventDefault(),form.validate()?(currentLoading=$loading().target(submitButton).start(),$scope.letschathook.id?$scope.letschathook.url?(promise=$repo.save($scope.letschathook),promise.then(function(data){return $scope.letschathook=data})):(promise=$repo.remove($scope.letschathook),promise.then(function(data){return $scope.letschathook={project:$scope.projectId,notify_userstory_create:!0,notify_userstory_change:!0,notify_userstory_delete:!0,notify_task_create:!0,notify_task_change:!0,notify_task_delete:!0,notify_issue_create:!0,notify_issue_change:!0,notify_issue_delete:!0,notify_wikipage_create:!0,notify_wikipage_change:!0,notify_wikipage_delete:!0}})):(promise=$repo.create("letschat",$scope.letschathook),promise.then(function(data){return $scope.letschathook=data})),promise.then(function(data){return currentLoading.finish(),$confirm.notify("success")}),promise.then(null,function(data){return currentLoading.finish(),form.setErrors(data),data._error_message?$confirm.notify("error",data._error_message):void 0})):void 0}}(this)),submitButton=$el.find(".submit-button"),$el.on("submit","form",submit),$el.on("click",".submit-button",submit)},{link:link}},module=angular.module("taigaContrib.letschat",[]),module.controller("ContribLetsChatAdminController",LetsChatAdmin),module.directive("contribLetschatWebhooks",["$tgRepo","$tgConfirm","$tgLoading",LetsChatWebhooksDirective]),initLetsChatPlugin=function($tgUrls){return $tgUrls.update({letschat:"/letschat"})},module.run(["$tgUrls",initLetsChatPlugin])}.call(this);